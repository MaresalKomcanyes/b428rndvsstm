<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>B-428 Duş ve Çamaşır Randevu Sistemi</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f5f5f5;margin:0;padding:18px;display:flex;flex-direction:column;align-items:center}
    h1{margin:6px 0 14px}
    .calendar{display:grid;grid-template-columns:repeat(7,130px);gap:6px;margin-bottom:18px}
    .day{height:120px;border-radius:8px;border:1px solid #ddd;background:#333;color:#fff;display:flex;flex-direction:column;align-items:flex-start;padding:10px;box-sizing:border-box}
    .day.past{background:#1f1f1f;color:#6d6d6d}
    .date-large{font-size:20px;font-weight:700;margin-bottom:6px}
    .slot{font-size:13px;background:rgba(255,255,255,0.06);padding:6px;border-radius:6px;margin-bottom:6px;width:100%}
    .has-events{background:#eefafe;color:#000}
    .form{width:360px;background:#fff;padding:12px;border-radius:10px;border:1px solid #e3e3e3}
    .form label{display:block;margin-top:8px;font-size:13px}
    .form input,.form select{width:100%;padding:8px;border-radius:6px;border:1px solid #ccc;margin-top:6px;box-sizing:border-box}
    .person-row{display:flex;gap:8px;align-items:center}
    .warning{color:#a22;margin-top:8px;min-height:18px}
    .small{font-size:12px;color:#666;margin-top:8px}
    @media (max-width:900px){ .calendar{grid-template-columns:repeat(7,calc((100vw - 40px)/7));} }
  </style>
</head>
<body>
  <h1>B-428 Duş ve Çamaşır Randevu Sistemi</h1>

  <div id="calendar" class="calendar" aria-live="polite"></div>

  <div class="form" id="form">
    <h3>Randevu Ekle</h3>

    <label>Yıl</label>
    <select id="year"></select>

    <label>Ay</label>
    <select id="month">
      <option>Ocak</option><option>Şubat</option><option>Mart</option><option>Nisan</option>
      <option>Mayıs</option><option>Haziran</option><option>Temmuz</option><option>Ağustos</option>
      <option>Eylül</option><option>Ekim</option><option>Kasım</option><option>Aralık</option>
    </select>

    <label>Gün</label>
    <select id="day"></select>

    <label>Saat (manuel)</label>
    <input id="time" placeholder="örn: 14:45" />

    <label>Kişi</label>
    <div class="person-row">
      <select id="person">
        <option>İBO</option><option>ÇAKO</option><option>RAMO</option>
      </select>
      <button type="button" id="addPersonBtn">+</button>
    </div>

    <div id="addPersonBox" style="display:none;margin-top:8px">
      <input id="newPerson" placeholder="Yeni kişi adı" />
      <div style="display:flex;gap:8px;margin-top:6px">
        <button id="addPersonDo">Ekle</button>
        <button id="removePerson">Sil</button>
      </div>
    </div>

    <label>Tür</label>
    <select id="type">
      <option>Çamaşır</option><option>Duş</option>
    </select>

    <div style="display:flex;gap:8px;margin-top:10px">
      <button id="saveBtn">Randevu Kaydet</button>
    </div>

    <div class="warning" id="warn"></div>
    <div class="small">Not: Veriler paylaşılan Firestore veritabanında saklanır; sayfa yenilendiğinde herkes güncellenir.</div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
  // ====== 1) Buraya Firebase config koyacaksın ======
  const firebaseConfig = {
    apiKey: "API_KEYIN",
    authDomain: "PROJECTID.firebaseapp.com",
    projectId: "PROJECTID",
    storageBucket: "PROJECTID.appspot.com",
    messagingSenderId: "SENDERID",
    appId: "APPID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // Yardımcı fonksiyonlar
  function pad(n){ return n<10?'0'+n:''+n }
  function dateKey(y,m,d){ return `${y}-${pad(m+1)}-${pad(d)}` }
  function parseTimeToMinutes(t){ const p=t.split(':'); return parseInt(p[0])*60+parseInt(p[1]) }

  let reservations = [];
  let extraPerson = null;

  const yearEl=document.getElementById('year');
  const monthEl=document.getElementById('month');
  const dayEl=document.getElementById('day');
  const timeEl=document.getElementById('time');
  const personEl=document.getElementById('person');
  const typeEl=document.getElementById('type');
  const warnEl=document.getElementById('warn');
  const now=new Date();

  for(let y=2025;y<=2030;y++){ const o=document.createElement('option'); o.value=y; o.textContent=y; yearEl.appendChild(o); }
  yearEl.value=now.getFullYear();
  monthEl.selectedIndex=now.getMonth();

  function updateDayOptions(){
    dayEl.innerHTML='';
    const y=parseInt(yearEl.value), m=monthEl.selectedIndex;
    const days=new Date(y,m+1,0).getDate();
    for(let d=1;d<=days;d++){
      const candidate=new Date(y,m,d);
      if(candidate<new Date(now.getFullYear(),now.getMonth(),now.getDate())) continue;
      const o=document.createElement('option'); o.value=d; o.textContent=d; dayEl.appendChild(o);
    }
  }

  yearEl.addEventListener('change',()=>{ updateDayOptions(); renderCalendar(); });
  monthEl.addEventListener('change',()=>{ updateDayOptions(); renderCalendar(); });
  updateDayOptions();

  function renderCalendar(){
    const cal=document.getElementById('calendar'); cal.innerHTML='';
    const y=parseInt(yearEl.value), m=monthEl.selectedIndex;
    const days=new Date(y,m+1,0).getDate();
    for(let d=1;d<=days;d++){
      const thisDate=new Date(y,m,d);
      const cell=document.createElement('div'); cell.className='day';
      if(thisDate<new Date(now.getFullYear(),now.getMonth(),now.getDate())) cell.classList.add('past');
      const dayKeyStr=dateKey(y,m,d);
      const dayEvents=reservations.filter(r=>r.date===dayKeyStr);
      if(dayEvents.length>0){ cell.classList.add('has-events'); const title=document.createElement('div'); title.className='date-large'; title.textContent=d; cell.appendChild(title);
        dayEvents.forEach(ev=>{ const s=document.createElement('div'); s.className='slot'; s.textContent=`${ev.type}: ${ev.person} ${ev.time? '('+ev.time+')':''}`; cell.appendChild(s); });
      } else { const big=document.createElement('div'); big.style.color='#fff'; big.style.fontSize='28px'; big.style.margin='auto'; big.textContent=d; cell.innerHTML=''; cell.appendChild(big); }
      cal.appendChild(cell);
    }
  }

  // Firestore listener
  db.collection('reservations').orderBy('createdAt').onSnapshot(snap=>{
    reservations=[]; snap.forEach(doc=>{ reservations.push(Object.assign({},doc.data(),{_id:doc.id})); });
    renderCalendar();
  });

  async function addReservationToFirestore(obj){
    try{ await db.collection('reservations').add(Object.assign({}, obj, { createdAt: firebase.firestore.FieldValue.serverTimestamp() })); }
    catch(e){ warnEl.textContent='Kaydetme hatası: '+e.message; }
  }

  async function addEvent(){
    warnEl.textContent='';
    const y=parseInt(yearEl.value), m=monthEl.selectedIndex, d=parseInt(dayEl.value);
    const time=timeEl.value.trim(), person=personEl.value, type=typeEl.value;
    if(!time.match(/^\d{1,2}:\d{2}$/)){ warnEl.textContent='Lütfen geçerli bir saat girin (örn: 14:45).'; return; }
    const [hh,mm]=time.split(':').map(Number);
    if(isNa
